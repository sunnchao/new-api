# 套餐管理功能测试清单

## 测试前准备

1. 确保后端服务正常运行
2. 确保数据库中有套餐计划数据
3. 准备测试用户账号（普通用户和管理员账号）

## 用户套餐管理测试 (`/console/subscriptions`)

### 基础功能测试

- [ ] 访问 `/console/subscriptions` 页面正常加载
- [ ] 未登录用户访问会跳转到登录页
- [ ] 页面显示 "套餐订阅" 标题
- [ ] 显示 "刷新" 按钮

### 套餐列表测试

- [ ] "可购买套餐" 卡片正常显示
- [ ] 套餐列表以网格形式展示（响应式布局）
- [ ] 每个套餐显示以下信息：
  - [ ] 套餐名称/类型
  - [ ] 套餐描述
  - [ ] 价格和货币
  - [ ] 总额度（格式化显示）
  - [ ] 时长（单位和数值）
  - [ ] 服务类型
  - [ ] "立即购买" 按钮
- [ ] 无套餐时显示 "暂无套餐可购买"
- [ ] 加载时显示 Spin 加载动画

### 购买套餐测试

- [ ] 点击 "立即购买" 打开购买弹窗
- [ ] 弹窗标题显示 "购买套餐"
- [ ] 显示套餐选择下拉框
- [ ] 显示支付方式（balance）
- [ ] 显示选中套餐的价格信息
- [ ] 点击确认后发送购买请求
- [ ] 购买成功显示成功提示
- [ ] 购买失败显示错误信息
- [ ] 购买成功后自动刷新订阅列表
- [ ] 余额不足时显示相应错误

### 订阅列表测试

- [ ] "我的订阅列表" 卡片正常显示
- [ ] 订阅以卡片形式展示
- [ ] 每个订阅显示以下信息：
  - [ ] 套餐类型/名称
  - [ ] 状态标签（颜色正确）
  - [ ] 服务类型
  - [ ] 剩余额度/总额度
  - [ ] 使用进度条
  - [ ] 到期时间
  - [ ] "确认取消" 按钮
- [ ] 无订阅时显示 "暂无订阅"
- [ ] 状态标签颜色正确：
  - [ ] 生效中 - 绿色
  - [ ] 已过期 - 灰色
  - [ ] 已取消 - 橙色
  - [ ] 已用尽 - 红色
  - [ ] 待支付 - 蓝色

### 取消订阅测试

- [ ] 只有 active 状态的订阅可以取消
- [ ] 其他状态的订阅取消按钮被禁用
- [ ] 点击取消显示确认弹窗
- [ ] 确认后发送取消请求
- [ ] 取消成功显示成功提示
- [ ] 取消失败显示错误信息
- [ ] 取消成功后自动刷新列表

### 数据格式化测试

- [ ] 额度 >= 1000000 显示为 "X.XXM"
- [ ] 额度 >= 10000 显示为 "X.XXW"
- [ ] 额度 < 10000 显示原始数字
- [ ] 时间戳正确转换为本地时间格式
- [ ] 无效时间显示为 "-"

## 管理员套餐管理测试 (`/console/admin-packages`)

### 基础功能测试

- [ ] 访问 `/console/admin-packages` 页面正常加载
- [ ] 非管理员用户访问被拒绝
- [ ] 页面显示 "套餐管理" 标题
- [ ] 显示 "订阅列表" 和 "计划管理" 标签切换按钮

### 订阅列表标签页测试

- [ ] 默认显示订阅列表标签页
- [ ] 显示 "刷新" 和 "分发套餐" 按钮
- [ ] 表格正常显示，包含以下列：
  - [ ] 用户（邮箱/用户名）
  - [ ] 套餐类型
  - [ ] 状态（带颜色标签）
  - [ ] 额度（剩余/总计）
  - [ ] 开始时间
  - [ ] 结束时间
  - [ ] 操作（取消/删除按钮）
- [ ] 分页功能正常工作
- [ ] 可以切换每页显示数量（10/20/50）
- [ ] 总数显示正确
- [ ] 加载时显示 loading 状态

### 分发套餐测试

- [ ] 点击 "分发套餐" 打开弹窗
- [ ] 弹窗标题显示 "分发套餐"
- [ ] 显示用户搜索输入框
- [ ] 输入至少2个字符开始搜索
- [ ] 搜索结果正常显示
- [ ] 点击用户可以选中
- [ ] 选中的用户显示蓝色标签
- [ ] 显示套餐选择下拉框
- [ ] 套餐列表包含服务类型信息
- [ ] 未选择用户或套餐时显示警告
- [ ] 确认分发后发送请求
- [ ] 分发成功显示成功提示
- [ ] 分发失败显示错误信息
- [ ] 分发成功后关闭弹窗并刷新列表
- [ ] 关闭弹窗时清空选择状态

### 取消订阅测试（管理员）

- [ ] 只有 active 状态的订阅显示取消按钮
- [ ] 其他状态的订阅取消按钮被禁用
- [ ] 点击取消显示确认弹窗
- [ ] 确认后发送 DELETE 请求到正确端点
- [ ] 取消成功显示成功提示
- [ ] 取消失败显示错误信息
- [ ] 取消成功后自动刷新列表

### 删除订阅测试

- [ ] 所有订阅都显示删除按钮
- [ ] 点击删除显示确认弹窗
- [ ] 确认后发送 DELETE 请求到正确端点
- [ ] 删除成功显示成功提示
- [ ] 删除失败显示错误信息
- [ ] 删除成功后自动刷新列表

### 计划管理标签页测试

- [ ] 切换到 "计划管理" 标签页
- [ ] 显示 "刷新" 和 "管理套餐" 按钮
- [ ] 表格正常显示，包含以下列：
  - [ ] 名称/类型
  - [ ] 类型
  - [ ] 价格（含货币）
  - [ ] 额度
  - [ ] 时长（数值+单位）
  - [ ] 服务类型
- [ ] 点击 "管理套餐" 跳转到 `/console/setting`
- [ ] 无分页（显示所有计划）

## 导航菜单测试

### 用户菜单

- [ ] 侧边栏显示 "个人财务" 部分
- [ ] "套餐订阅" 菜单项正常显示
- [ ] 点击跳转到 `/console/subscriptions`
- [ ] 当前页面时菜单项高亮

### 管理员菜单

- [ ] 侧边栏显示 "管理" 部分
- [ ] "套餐管理" 菜单项正常显示（仅管理员可见）
- [ ] 点击跳转到 `/console/admin-packages`
- [ ] 当前页面时菜单项高亮
- [ ] 普通用户不显示此菜单项

## 多语言测试

- [ ] 切换到英文，所有文本正确翻译
- [ ] 切换到日文，所有文本正确翻译
- [ ] 切换到俄文，所有文本正确翻译
- [ ] 切换到法文，所有文本正确翻译
- [ ] 切换到越南文，所有文本正确翻译
- [ ] 切换回中文，所有文本正确显示

## API端点测试

### 用户端点

- [ ] `GET /api/user/packages/plans` 返回套餐列表
- [ ] `GET /api/user/packages/subscriptions` 返回用户订阅
- [ ] `POST /api/user/packages/purchase` 购买套餐成功
- [ ] `POST /api/user/packages/cancel` 取消订阅成功

### 管理员端点

- [ ] `GET /api/packages-admin/subscriptions?p=1&page_size=10` 返回分页订阅
- [ ] `GET /api/packages-admin/plans` 返回套餐计划
- [ ] `GET /api/packages-admin/users/search?keyword=xxx` 返回用户搜索结果
- [ ] `POST /api/packages-admin/grant-subscription` 分发套餐成功
- [ ] `DELETE /api/packages-admin/subscriptions/:id` 删除订阅成功

## 错误处理测试

- [ ] 网络错误时显示友好提示
- [ ] API返回错误时显示错误信息
- [ ] 权限不足时正确处理
- [ ] 数据加载失败时显示错误横幅
- [ ] 表单验证错误时显示提示

## 响应式设计测试

- [ ] 桌面端（>1024px）布局正常
- [ ] 平板端（768-1024px）布局正常
- [ ] 移动端（<768px）布局正常
- [ ] 套餐卡片网格响应式调整
- [ ] 表格在小屏幕上可横向滚动

## 性能测试

- [ ] 页面首次加载时间 < 2秒
- [ ] 数据刷新响应时间 < 1秒
- [ ] 大量订阅数据时表格渲染流畅
- [ ] 分页切换流畅无卡顿

## 浏览器兼容性测试

- [ ] Chrome 最新版
- [ ] Firefox 最新版
- [ ] Safari 最新版
- [ ] Edge 最新版

## 测试结果记录

测试日期：__________
测试人员：__________
测试环境：__________

通过项数：_____ / _____
失败项数：_____

主要问题：
1. 
2. 
3. 

备注：
